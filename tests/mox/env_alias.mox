(* application: shared variable used in both function and argument *)
let shared = ((unit, unit) : (unit *[unique local] unit)) in
((fun f => f shared) : ((unit *[unique local] unit) -> unit) -> unit)
  ((fun g => g shared) : ((unit *[unique local] unit) -> unit))
> error: relation became empty

(* application: non-shared variables used in both functions *)
let non_shared1 = ((unit, unit) : (unit *[unique] unit)) in
let non_shared2 = ((unit, unit) : (unit *[unique] unit)) in
(((fun f => f non_shared1) : ((unit *[unique] unit) -> unit) ->[once] unit),
 ((fun g => g non_shared2) : ((unit *[unique] unit) -> unit) ->[once] unit))
> ((((unit *[u=u3 a=a7] unit) ->[a=a6 l=l4 p=p4] unit) ->[a=a5 l=l3 p=p3] unit) *[u=u2 a=a4] (((unit *[u=u1 a=a3] unit) ->[a=a2 l=l2 p=p2] unit) ->[a=a1 l=l1 p=p1] unit))
> mode vars
>   p1 ∈ {non-portable, portable}
>   l1 ∈ {many, never, once}
>   a1 ∈ {global, local, regional}
>   p2 ∈ {non-portable, portable}
>   l2 ∈ {many, never, once}
>   a2 ∈ {global, local, regional}
>   a3 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
>   a4 ∈ {global, local, regional}
>   u2 ∈ {aliased, unique}
>   p3 ∈ {non-portable, portable}
>   l3 ∈ {many, never, once}
>   a5 ∈ {global, local, regional}
>   p4 ∈ {non-portable, portable}
>   l4 ∈ {many, never, once}
>   a6 ∈ {global, local, regional}
>   a7 ∈ {global, local, regional}
>   u3 ∈ {aliased, unique}
> mode rels
>   (u3,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u3,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (a7,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (l4,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l4,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l4,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (p4,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p4,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p4,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}

(* application: non-shared variables used in both functions, but one is many *)
let non_shared1 = ((unit, unit) : (unit *[unique] unit)) in
let non_shared2 = ((unit, unit) : (unit *[unique] unit)) in
(((fun f => f non_shared1) : ((unit *[unique] unit) ->[once] unit) ->[many] unit),
 ((fun g => g non_shared2) : ((unit *[unique] unit) ->[once] unit) ->[once] unit))
> ((((unit *[u=u3 a=a7] unit) ->[a=a6 l=l4 p=p4] unit) ->[a=a5 l=l3 p=p3] unit) *[u=u2 a=a4] (((unit *[u=u1 a=a3] unit) ->[a=a2 l=l2 p=p2] unit) ->[a=a1 l=l1 p=p1] unit))
> mode vars
>   p1 ∈ {non-portable, portable}
>   l1 ∈ {many, never, once}
>   a1 ∈ {global, local, regional}
>   p2 ∈ {non-portable, portable}
>   l2 ∈ {many, never, once}
>   a2 ∈ {global, local, regional}
>   a3 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
>   a4 ∈ {global, local, regional}
>   u2 ∈ {aliased, unique}
>   p3 ∈ {non-portable, portable}
>   l3 ∈ {many, never, once}
>   a5 ∈ {global, local, regional}
>   p4 ∈ {non-portable, portable}
>   l4 ∈ {many, never, once}
>   a6 ∈ {global, local, regional}
>   a7 ∈ {global, local, regional}
>   u3 ∈ {aliased, unique}
> mode rels
>   (u3,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u3,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (a7,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a7,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a6,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a5,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a4,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a7) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a6) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a5) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a4) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (l4,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l4,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l4,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l3,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l2,l1) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l4) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l3) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (l1,l2) ∈ {(many,many), (many,once), (many,never), (once,many), (once,once), (once,never), (never,many), (never,once), (never,never)}
>   (p4,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p4,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p4,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p3,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p2,p1) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p4) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p3) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}
>   (p1,p2) ∈ {(portable,portable), (portable,non-portable), (non-portable,portable), (non-portable,non-portable)}

(* application: shared variable used in both function and argument *)
let shared = ((unit, unit) : (unit *[unique] unit)) in
(((fun f => f shared) : ((unit *[unique] unit) ->[once] unit) ->[once] unit),
 ((fun g => g shared) : ((unit *[unique] unit) ->[once] unit) ->[once] unit))
> error: relation became empty

(* pair: shared variable appears in both components *)
let shared = ((unit, unit) : (unit *[unique local] unit)) in
(shared, shared) : (unit *[local] unit) *[local] (unit *[local] unit)
> ((unit *[u=aliased a=a1] unit) *[u=u1 a=a2] (unit *[u=aliased a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   a2 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
> mode rels
>   (u1,u2) ∈ {(unique,aliased), (aliased,aliased)}
>   (u2,u1) ∈ {(aliased,unique), (aliased,aliased)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* pair: shared variable appears in both components *)
let shared = ((unit, unit) : (unit *[unique] unit)) in
(shared, shared) : (unit *[aliased] unit) *[unique] (unit *[aliased] unit)
> ((unit *[u=aliased a=a1] unit) *[u=u1 a=a2] (unit *[u=aliased a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   a2 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
> mode rels
>   (u1,u2) ∈ {(unique,aliased), (aliased,aliased)}
>   (u2,u1) ∈ {(aliased,unique), (aliased,aliased)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* let-binding: shared variable used in initializer and body *)
let shared = ((unit, unit) : (unit *[local] unit)) in
let alias = shared in
(shared, alias)
> ((unit *[u=aliased a=a1] unit) *[u=u1 a=a2] (unit *[u=aliased a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   a2 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
> mode rels
>   (u1,u2) ∈ {(unique,aliased), (aliased,aliased)}
>   (u2,u1) ∈ {(aliased,unique), (aliased,aliased)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* let-pair: shared variable used alongside destructured pair *)
let shared = ((unit, unit) : (unit *[unique local] unit)) in
let pair = (shared, shared) in
let (x, y) = pair in
(x, y)
> ((unit *[u=u3 a=a3] unit) *[u=u2 a=a2] (unit *[u=u1 a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
>   a2 ∈ {global, local, regional}
>   u2 ∈ {aliased, unique}
>   a3 ∈ {global, local, regional}
>   u3 ∈ {aliased, unique}
> mode rels
>   (u3,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u3,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (a3,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* match: shared variable used in both branches *)
let shared = ((unit, unit) : (unit *[unique local] unit)) in
match left(shared) with left(x) => x | right(y) => shared
> (unit *[u=u1 a=a1] unit)
> mode vars
>   a1 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}

(* pair with aliased shared value *)
let shared = ((unit, unit) : (unit *[aliased] unit)) in
(shared, shared)
> ((unit *[u=aliased a=a1] unit) *[u=u1 a=a2] (unit *[u=aliased a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   a2 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
> mode rels
>   (u1,u2) ∈ {(unique,aliased), (aliased,aliased)}
>   (u2,u1) ∈ {(aliased,unique), (aliased,aliased)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* let-binding success with aliasable shared value *)
let shared = ((unit, unit) : (unit *[aliased] unit)) in
let alias = shared in
(shared, alias)
> ((unit *[u=aliased a=a1] unit) *[u=u1 a=a2] (unit *[u=aliased a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   a2 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
> mode rels
>   (u1,u2) ∈ {(unique,aliased), (aliased,aliased)}
>   (u2,u1) ∈ {(aliased,unique), (aliased,aliased)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* let-pair success with aliasable shared value *)
let shared = ((unit, unit) : (unit *[aliased] unit)) in
let pair = (shared, shared) in
let (x, y) = pair in
(x, y)
> ((unit *[u=u3 a=a3] unit) *[u=u2 a=a2] (unit *[u=u1 a=a1] unit))
> mode vars
>   a1 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
>   a2 ∈ {global, local, regional}
>   u2 ∈ {aliased, unique}
>   a3 ∈ {global, local, regional}
>   u3 ∈ {aliased, unique}
> mode rels
>   (u3,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u3,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u2,u1) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u3) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (u1,u2) ∈ {(unique,unique), (unique,aliased), (aliased,unique), (aliased,aliased)}
>   (a3,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a3,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a2,a1) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a3) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}
>   (a1,a2) ∈ {(global,global), (global,regional), (global,local), (regional,global), (regional,regional), (regional,local), (local,global), (local,regional), (local,local)}

(* match with aliasable shared value still fails: need better inference *)
let shared = ((unit, unit) : (unit *[aliased local] unit)) in
match left(shared) with left(x) => x | right(y) => shared
> (unit *[u=u1 a=a1] unit)
> mode vars
>   a1 ∈ {global, local, regional}
>   u1 ∈ {aliased, unique}
